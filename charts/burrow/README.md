# Burrow - Kafka Consumer Lag Checking

[Burrow](https://github.com/linkedin/Burrow), is a monitoring companion for [Apache Kafka](http://kafka.apache.org) that provides consumer lag checking as a service without the need for specifying thresholds. It monitors committed offsets for all consumers and calculates the status of those consumers on demand. An HTTP endpoint is provided to request status on demand, as well as provide other Kafka cluster information. There are also configurable notifiers that can send status out via email or HTTP calls to another service.

## TL;DR;

```console
# Add the Repository to Helm:

$ helm repo add lowess-helm https://lowess.github.io/helm-charts

# Install burrow

$ helm install lowess-helm/burrow
```

## Introduction

This chart bootstraps a [Burrow](https://github.com/linkedin/Burrow) deployment on a [Kubernetes](http://kubernetes.io) cluster using the [Helm](https://helm.sh) package manager.

## Prerequisites

- Kubernetes 1.3+ with Beta APIs enabled

## Installing the Chart

To install the chart with the release name `my-release`:

```console

$ helm install --name my-release lowess-helm/burrow
```

The command deploys Burrow on the Kubernetes cluster in the default configuration. The [configuration](#configuration) section lists the parameters that can be configured during installation.

> **Tip**: List all releases using `helm list`

## Uninstalling the Chart

To uninstall/delete the `my-release` deployment:

```console
$ helm delete my-release
```

The command removes all the Kubernetes components associated with the chart and deletes the release.

## Configuration

The following table lists the configurable parameters of the Burrow chart and their default values.

Parameter | Description | Default
--------- | ----------- | -------
`burrow.labels` | Labels to apply to burrrow pods | `{}`
`burrow.annotations` | Annotations to apply to burrrow pods | `{}`
`burrow.secretConfig` | The name of the secret containing configuration environment variables | `""`
`burrow.templateDir` | Mountpoint used to expose templates generated by `burrow.templates` | `/etc/burrow/templates`
`burrow.config.general.pidfile` | Location of burrow pidfile | `burrow.pid`
`burrow.config.logging.level` | Logging level of burrow | `info`
`burrow.config.zookeeper.servers` | A list of strings in the form "hostname:port" that point to the servers in the Zookeeper ensemble. At least one is required | `[zookeeper:2181]`
`burrow.config.zookeeper.timeout` | The expiration timeout for Zookeeper sessions, in seconds | `6`
`burrow.config.zookeeper.rootPath` | A full path to the znode that Burrow is allow to write under. The path will be created if it does not already exist | `/burrow`
`burrow.config.httpserver.default.address` | Specifies what the server should listen on | `:8000`
`burrow.config.httpserver.default.timeout` | The timeout and keepalive setting for connections, in seconds | `300`
`burrow.config.cluster.<myclustername>` | The `<myclustername>` part is the name by which this cluster will be referred to in other parts of the configuration (if not overriden by `burrow.config.cluster.<myclustername>.clusterName`), as well as in HTTP requests and notifications. You may configure as many cluster sections as you want (and Burrow is efficient at handling multiple Kafka clusters). Note that the cluster configuration only retrieves the topic list and cluster offsets. | `{}`
`burrow.config.cluster.<myclustername>.clusterName` | Overrides the cluster name which default to the map key `<myclustername>` |
`burrow.config.cluster.<myclustername>.className` | This is the name of the cluster module type. The only available class is `kafka` | `kafka`
`burrow.config.cluster.<myclustername>.servers` | A list of strings in the form "hostname:port" that point to the servers in the Kafka cluster. At least one is required |
`burrow.config.cluster.<myclustername>.topicRefresh` | How often to refresh the list of all topics in the cluster, in seconds | `60`
`burrow.config.cluster.<myclustername>.offsetRefresh` | How often to refresh the broker offset for each partition, in seconds | `10`
`burror.config.tls.<tlsprofile>.certFile` | The path to the certificate file to be used (either a client certificate for client connections, or a server certificate for the HTTP server). | /tmp/client_cert.pem
`burror.config.tls.<tlsprofile>.keyFile` | The path to the key file that matches the certfile. | /tmp/private_key.pem
`burror.config.tls.<tlsprofile>.caFile` | If specified, it is the path to a bundle of certificates that provide the trusted root certificates for the connection. | /tmp/truststore.pem
`burror.config.tls.<tlsprofile>.noverify` | If true, do not validate the trust of the certificate sent by the other side of this connection. | false
`burrow.config.consumer.<myclustername>.clusterName` | If `burrow.config.cluster.<myclustername>.clusterName` is set then this setting must be set to the same value |
`burrow.config.consumer.<myclustername>.className` | This is the name of the cluster module type. The available classes are: `kafka` or `kafka_zk` | `kafka`
`burrow.config.consumer.<myclustername>.servers` | A list of strings in the form "hostname:port" that point to the servers in the Kafka cluster. At least one is required |
`burrow.config.consumer.<myclustername>.groupAllowlist` | If specified, only send offsets for groups that match this regular expression | `.*`
`burrow.config.consumer.<myclustername>.groupDenylist` | If specified, only send offsets for groups that DO NOT match this regular expression. This is processed after the whitelist (if specified) | `^.*(console-consumer-|python-kafka-consumer-).*`
`burrow.config.notifier.<mynotifier>.className` | This is the name of the cluster module type. The available classes are: `http` or `email` | `http`
`burrow.config.notifier.<mynotifier>.interval` | The number of seconds to wait between sending notifications for a single group | `60`
`burrow.config.notifier.<mynotifier>.threshold` | The minimum group status to send out notifications for (refer to [StatusConstant](https://godoc.org/github.com/linkedin/Burrow/core/protocol#StatusConstant) for values). | `1`
`burrow.config.notifier.<mynotifier>.groupDenylist` | If specified, only send notifications for groups that DO NOT match this regular expression. This is processed after the whitelist (if specified) | `^.*(console-consumer-|python-kafka-consumer-).*$`
`burrow.config.notifier.<mynotifier>.groupAllowlist` | If specified, only send notifications for groups that match this regular expression | `^.*$`
`burrow.config.notifier.<mynotifier>.extras` | A string representation of a JSON object that will be available when compiling the template for the message to send | `'{}'`
`burrow.config.notifier.<mynotifier>.sendClose` | If `true`, use the template-close template to send a notification when the group status drops to OK (after it has been WARN or above) | `true`
`burrow.config.notifier.<mynotifier>.urlOpen` | The URL to make a request to for groups that meet the threshold |
`burrow.config.notifier.<mynotifier>.urlClose` | The URL to make a request to for groups that have transitioned back to OK from a bad state (WARN or above), if send-close is true |
`burrow.config.notifier.<mynotifier>.templateOpen` | The name of a template defined in `burrow.template` that is used to compile the message to send for groups that pass the whitelist and status threshold (see Templates for more information on building the template) |
`burrow.config.notifier.<mynotifier>.templateClose` | The name of a template defined in `burrow.template` that is used to compile the message to send for groups that transition to OK (if `sendClose` is `true`) |
`burrow.templates.<templateA>` | A compliant [Burrow Template](https://github.com/linkedin/Burrow/wiki/Templates) to format the payload sent by notifiers | `{}`

Specify each parameter using the `--set key=value[,key=value]` argument to `helm install`. For example,

```console
$ helm install lowess-helm/burrow --name my-release \
    --set burrow.config.zookeeper.servers={01.zk.example.com:2181,02.zk.example.com:2181,03.zk.example.com:2181}
```

Alternatively, a YAML file that specifies the values for the above parameters can be provided while installing the chart. For example,

```console
$ helm install lowess-helm/burrrow --name my-release -f values.yaml
```

> **Tip**: You can use the default [values.yaml](values.yaml)

### ConfigMap Files

Burrrow is configured through [burrow.toml](https://github.com/linkedin/Burrow/wiki/Configuration). This file (and any others listed in `burrow.config`) will be mounted into the `burrow` pod.

Burrrow templates are configured through [Golang text template](https://github.com/linkedin/Burrow/wiki/Templates). This file (and any others listed in `burrow.templates`) will be mounted into the `burrow` pod.

